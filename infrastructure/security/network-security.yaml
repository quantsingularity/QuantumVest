# Network Security Configuration

# Firewall Rules
firewall_rules:
  ingress:
    # Web Traffic
    - name: "allow-https"
      protocol: "tcp"
      port: 443
      source: "0.0.0.0/0"
      action: "allow"

    - name: "allow-http-redirect"
      protocol: "tcp"
      port: 80
      source: "0.0.0.0/0"
      action: "allow"

    # SSH Access (restricted)
    - name: "allow-ssh-admin"
      protocol: "tcp"
      port: 22
      source: "10.0.0.0/8" # Internal networks only
      action: "allow"

    # Database Access (internal only)
    - name: "allow-database"
      protocol: "tcp"
      port: 5432
      source: "10.0.1.0/24" # App subnet only
      action: "allow"

    # Redis Cache (internal only)
    - name: "allow-redis"
      protocol: "tcp"
      port: 6379
      source: "10.0.1.0/24" # App subnet only
      action: "allow"

    # Monitoring
    - name: "allow-prometheus"
      protocol: "tcp"
      port: 9090
      source: "10.0.2.0/24" # Monitoring subnet only
      action: "allow"

    # Default deny
    - name: "deny-all"
      protocol: "all"
      port: "all"
      source: "0.0.0.0/0"
      action: "deny"
      priority: 1000

  egress:
    # HTTPS outbound (for API calls, updates)
    - name: "allow-https-out"
      protocol: "tcp"
      port: 443
      destination: "0.0.0.0/0"
      action: "allow"

    # DNS
    - name: "allow-dns"
      protocol: "udp"
      port: 53
      destination: "0.0.0.0/0"
      action: "allow"

    # NTP
    - name: "allow-ntp"
      protocol: "udp"
      port: 123
      destination: "0.0.0.0/0"
      action: "allow"

    # Block all other outbound
    - name: "deny-all-out"
      protocol: "all"
      port: "all"
      destination: "0.0.0.0/0"
      action: "deny"
      priority: 1000

# Network Segmentation
network_segments:
  dmz:
    cidr: "10.0.0.0/24"
    description: "DMZ for load balancers and reverse proxies"
    security_level: "high"

  application:
    cidr: "10.0.1.0/24"
    description: "Application servers"
    security_level: "high"

  database:
    cidr: "10.0.2.0/24"
    description: "Database servers"
    security_level: "critical"

  monitoring:
    cidr: "10.0.3.0/24"
    description: "Monitoring and logging infrastructure"
    security_level: "medium"

  management:
    cidr: "10.0.4.0/24"
    description: "Management and bastion hosts"
    security_level: "critical"

# WAF (Web Application Firewall) Configuration
waf_config:
  enabled: true
  rules:
    - name: "sql_injection_protection"
      type: "sql_injection"
      action: "block"
      sensitivity: "high"

    - name: "xss_protection"
      type: "cross_site_scripting"
      action: "block"
      sensitivity: "high"

    - name: "rate_limiting"
      type: "rate_limit"
      requests_per_minute: 100
      burst_limit: 200
      action: "throttle"

    - name: "geo_blocking"
      type: "geo_ip"
      blocked_countries: [] # Configure based on business needs
      action: "block"

    - name: "bot_protection"
      type: "bot_detection"
      action: "challenge"
      whitelist_user_agents:
        - "QuantumVest-HealthCheck/1.0"

# DDoS Protection
ddos_protection:
  enabled: true
  threshold_pps: 10000 # packets per second
  threshold_bps: "100Mbps" # bits per second
  mitigation_actions:
    - "rate_limit"
    - "geo_block"
    - "challenge_response"
  notification_endpoints:
    - "security@quantumvest.com"
    - "ops@quantumvest.com"

# VPN Configuration
vpn_config:
  enabled: true
  type: "site_to_site"
  encryption: "AES-256"
  authentication: "PSK" # Pre-shared key
  dead_peer_detection: true
  allowed_networks:
    - "10.0.0.0/8"
    - "172.16.0.0/12"
    - "192.168.0.0/16"

# Network Monitoring
network_monitoring:
  flow_logs: true
  packet_capture: true # For security incidents only
  intrusion_detection: true
  anomaly_detection: true
  retention_days: 90

# SSL/TLS Configuration
ssl_config:
  min_version: "1.2"
  preferred_version: "1.3"
  cipher_suites:
    - "ECDHE-RSA-AES256-GCM-SHA384"
    - "ECDHE-RSA-AES128-GCM-SHA256"
    - "ECDHE-RSA-AES256-SHA384"
    - "ECDHE-RSA-AES128-SHA256"
  hsts_enabled: true
  hsts_max_age: 31536000 # 1 year
  certificate_transparency: true
